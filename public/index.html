<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RustorgUO Support Server</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
            background: #f5f5f5;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .status { 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
        .status.ok { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.checking { background: #fff3cd; color: #856404; }
        .endpoint { 
            background: #f8f9fa; 
            padding: 15px; 
            border-left: 4px solid #007bff;
            margin: 15px 0;
            border-radius: 3px;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0069d9;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ RustorgUO Support Server</h1>
        <p>–°–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —á–µ—Ä–µ–∑ Telegram</p>
        
        <div id="status" class="status checking">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</div>
        
        <h2>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:</h2>
        
        <div class="endpoint">
            <strong>GET /</strong> - –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
        </div>
        
        <div class="endpoint">
            <strong>POST /webhook</strong> - Webhook –¥–ª—è Telegram
        </div>
        
        <div class="endpoint">
            <strong>POST /api/send-message</strong> - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </div>
        
        <div class="endpoint">
            <strong>GET /api/messages/:sessionId</strong> - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        </div>
        
        <div class="endpoint">
            <strong>GET /api/status</strong> - –°—Ç–∞—Ç—É—Å API
        </div>
        
        <div class="endpoint">
            <strong>POST /set-webhook</strong> - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±—Ö—É–∫–∞ Telegram
        </div>
        
        <h2>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–æ–º:</h2>
        <button onclick="setWebhook()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ–±—Ö—É–∫</button>
        <button onclick="deleteWebhook()">–£–¥–∞–ª–∏—Ç—å –≤–µ–±—Ö—É–∫</button>
        <button onclick="getWebhookInfo()">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ–±—Ö—É–∫–µ</button>
        <button onclick="getBotInfo()">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ</button>
        
        <div id="result"></div>
    </div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
        async function checkStatus() {
            try {
                const response = await fetch('/api/status');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                document.getElementById('status').className = 'status ok';
                document.getElementById('status').innerHTML = 
                    `‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç | –í—Ä–µ–º—è: ${data.serverTime || '–Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ'} | –°–æ–æ–±—â–µ–Ω–∏–π: ${data.messagesCount || '0'} | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${data.usersCount || '0'}`;
                    
            } catch (error) {
                document.getElementById('status').className = 'status error';
                document.getElementById('status').innerHTML = '‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω: ' + error.message;
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–æ–º
        async function setWebhook() {
            const webhookUrl = prompt('–í–≤–µ–¥–∏—Ç–µ URL –¥–ª—è –≤–µ–±—Ö—É–∫–∞:', `${window.location.origin}/webhook`);
            if (webhookUrl) {
                try {
                    showResult("–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±—Ö—É–∫–∞...");
                    const response = await fetch('/set-webhook', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ webhookUrl })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    showResult(JSON.stringify(result, null, 2));
                } catch (error) {
                    showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
                }
            }
        }
        
        async function deleteWebhook() {
            try {
                showResult("–£–¥–∞–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞...");
                const response = await fetch('/delete-webhook', { method: 'POST' });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                showResult(JSON.stringify(result, null, 2));
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        async function getWebhookInfo() {
            try {
                showResult("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–µ–±—Ö—É–∫–µ...");
                const response = await fetch('/get-webhook-info');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                showResult(JSON.stringify(result, null, 2));
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        async function getBotInfo() {
            try {
                showResult("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ...");
                const response = await fetch('/get-bot-info');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                showResult(JSON.stringify(result, null, 2));
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞: ${error.message}`, true);
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResult(message, isError = false) {
            const resultElement = document.getElementById('result');
            resultElement.innerHTML = `<pre>${message}</pre>`;
            resultElement.style.backgroundColor = isError ? '#f8d7da' : '#d4edda';
            resultElement.style.borderLeftColor = isError ? '#721c24' : '#155724';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkStatus();
        setInterval(checkStatus, 30000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    </script>
</body>
</html>
